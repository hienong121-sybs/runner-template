# Codex Changelog - 2026-02-12 - #06

## 1) Yêu cầu thay đổi
- [x] Làm rõ và khắc phục tình trạng `shadow.mirror.log` không ghi dòng dù mirror đã chạy.

## 2) Cấu hình/env ảnh hưởng
- Không thêm env mới.

## 3) Tóm tắt thay đổi
- Bổ sung `log_subrequest on;` trong server nginx để access log cho subrequest `/__shadow` được ghi.

## 4) Chi tiết thay đổi
- Root cause:
  - Mirror subrequest đã chạy (thể hiện qua `subrequest: "/__shadow"` trong `app.error.log`).
  - Nhưng access log cho subrequest không xuất hiện do mặc định nginx không log subrequest.
- Fix:
  - Thêm `log_subrequest on;` trong `nginx/conf.d/app.conf.template`.

## 5) Git diff trọng tâm
```diff
diff --git a/nginx/conf.d/app.conf.template b/nginx/conf.d/app.conf.template
@@
   resolver ${TAILSCALE_DNS_NAMESERVER_PRIMARY} ${TAILSCALE_DNS_NAMESERVER_FALLBACK} valid=10s ipv6=off;
   resolver_timeout 2s;
+  log_subrequest on;
```

## 6) Verify đã chạy
- Không chạy test/lint theo yêu cầu.
- Rà lại config template chứa `log_subrequest on;`.

## 7) Commit message đề xuất
```text
fix(nginx): enable subrequest access logging for shadow mirror
```
