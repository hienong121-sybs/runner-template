# Codex Changelog - 2026-02-12 - #03

## 1) Yêu cầu thay đổi
- [x] Hotfix lỗi Docker mountpoint readonly cho service `docker-manager`.

## 2) Cấu hình/env ảnh hưởng
- Đổi log dir trong compose runtime:
  - từ `DOCKER_MANAGER_LOG_DIR=/opt/docker-manager/runtime`
  - sang `DOCKER_MANAGER_LOG_DIR=/opt/docker-manager-runtime`

## 3) Tóm tắt thay đổi
- Sửa conflict mount lồng nhau dưới path read-only.
- Đồng bộ cả:
  - `docker-compose.yml` (file YAML local)
  - `DOCKER_COMPOSE_YML_BASE64` trong `.env-runner-template/.env.runner-template`

## 4) Chi tiết thay đổi
- Nguyên nhân:
  - Code mount `./docker-manager:/opt/docker-manager:ro` làm parent read-only.
  - Mount con `./.docker-manager:/opt/docker-manager/runtime` thất bại vì Docker không tạo được mountpoint con trong vùng read-only.
- Cách sửa:
  - Chuyển runtime log mountpoint sang path độc lập:
    - `./.docker-manager:/opt/docker-manager-runtime`
  - Cập nhật entrypoint mkdir tương ứng:
    - `mkdir -p /opt/docker-manager-runtime /opt/nginx/shadow-servers`

## 5) Git diff trọng tâm
```diff
diff --git a/docker-compose.yml b/docker-compose.yml
@@
-      - DOCKER_MANAGER_LOG_DIR=/opt/docker-manager/runtime
+      - DOCKER_MANAGER_LOG_DIR=/opt/docker-manager-runtime
@@
-        mkdir -p /opt/docker-manager/runtime /opt/nginx/shadow-servers
+        mkdir -p /opt/docker-manager-runtime /opt/nginx/shadow-servers
@@
-      - ./.docker-manager:/opt/docker-manager/runtime
+      - ./.docker-manager:/opt/docker-manager-runtime
```

## 6) Verify đã chạy
- Rà lại `docker-compose.yml` có đủ 3 thay đổi path mới.
- Decode `DOCKER_COMPOSE_YML_BASE64` từ `.env-runner-template/.env.runner-template` để xác nhận:
  - không còn `/opt/docker-manager/runtime`
  - đã có `/opt/docker-manager-runtime`

## 7) Commit message đề xuất
```text
fix(docker-manager): avoid readonly nested mount by moving runtime log mountpoint
```
